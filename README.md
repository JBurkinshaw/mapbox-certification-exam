# Vancouver TransLink Vehicle Locations

A web map displaying live locations of TransLink's vehicles based on data from their [GTFS-realtime Open API](https://developer.translink.ca/ServicesGtfs').

The popups display data from the GTFS feed and a random [Mapilliary]('https://www.mapillary.com/) image.

It was created by Joe Burkinshaw at [Sparkgeo](https://sparkgeo.com/) as a Mapbox GL JS example for Mapbox's Developer Certification Program. It is not intended to have a real life use. The code is not perfect - writing it was as an opportunity to work with Mapbox GL JS in an application using React-Redux and React hooks and function components.

Here's a [demo](https://vancouver-vehicle-locations.netlify.app/).

## Quick start
1. Install dependencies `yarn install`
2. Development instance `yarn start` - available at `http://localhost:3000`
3. Build `yarn build`

## Component and Library Layout

### Directories

Each of these directories are of a single depth.

| Directory    | Description                                         |
| ------------ | --------------------------------------------------- |
| `components` | All visual components                               |
| `helpers`    | Immutable JS functions                              |
| `lib`        | All JS tools that aren't immutable helper functions |


### Special Files

| File Name         | Description                                         |
| ----------------- | --------------------------------------------------- |
| theme.js          | Theme information for grommet and styled components |
| App.css           | All CSS for all core DOM elements                   |
| .eslintrc         | Instructions for linting rules                      |
| .eslintignore     | Where to ignore the linting rules entirely          |
| .prettierrc       | Configuration instructions for autoformat rules     |
| .serviceWorker.js | Autogenerated file by CRA that assists with PWAs    |

## Styling

- App.css for global rules of HTML elements
    - 1rem = 10px by default
    - Most defaults will be pulled from the design system.
- [Grommet](https://https://v2.grommet.io) for abstract primitives (Box, Form, FormField, etc)
- [Styled Components](https://www.styled-components.com/) for styling at the component-level.

## Testing

Testing is built using both React Enzyme, Jest and is controlled at the test level using [react-testing-library](https://testing-library.com/docs). Testing in the components takes place in component directories. While testing still has yet to be incolcated into Sparkgeo's culture, we should strive to test behaviour more. Integration testing is better than testing, behaviour (ie what does the container do when it loads; how many times does it make a network request) is better than Unit behaviour testing (when the props are of a certain type, what colour does it show).

## Make this a Mobile App!

In order to build a **progessive web app (PWA)**, you need to carry out the following:

1. Go to `src/index.js`
   1. Follow the direction at the end of the file
2. Build the application (`npm run build`) and open in Chrome
3. In the Chrome dev tools, under "Audits", run an audit for the app. Ensure that the "PWA" option is selected.
4. Fix what it tells you to fix until you see a checkmark under the "PWA" result.

It's that easy. Boom, you have a PWA. Note that this setup has no configuration for local storage or Indexed DB. You'll have to figure that on your own.

## Linting and Code Formatting (Static Testing)

Linting is based on a subset of AirBNB's style guide and internal best practices. The outcome of this combination is still yet to be confirmed. If a lint setting is generally preventing you from accomplishing your goals, talk with the team in #guild-frontend. Either you're too invested in an antipattern, or we have a linter setting that needs to change.

If a linter setting is in conflict with the autoformatter (Prettier), we will opt for the autoformatter. When we build code, we should keep our focus on the content, not the format.
